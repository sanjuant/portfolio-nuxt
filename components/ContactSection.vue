<template>
  <div
    id="contact"
    class="overflow-hidden bg-gray-50 pb-12 pt-12 pb-40 dark:bg-slate-800 lg:pb-32 lg:pt-16"
  >
    <!-- Contact section -->
    <section
      class="relative px-4 sm:px-6 lg:px-8"
      aria-labelledby="contact-heading"
    >
      <div class="mx-auto mt-3 max-w-7xl">
        <div class="max-w-3xl lg:ml-auto lg:mr-4">
          <p
            class="relative z-[1] mb-6 text-base font-semibold uppercase leading-6 tracking-wide text-indigo-600 dark:text-indigo-500"
          >
            Contact
          </p>
          <div class="relative rounded-lg bg-transparent shadow-xl">
            <!-- Decorative dot pattern -->
            <svg
              class="absolute -top-24 -right-24"
              width="404"
              height="384"
              fill="none"
              viewBox="0 0 404 384"
              aria-hidden="true"
            >
              <defs>
                <pattern
                  id="64e643ad-2176-4f86-b3d7-f2c5da3b6a6d"
                  x="0"
                  y="0"
                  width="20"
                  height="20"
                  patternUnits="userSpaceOnUse"
                >
                  <rect
                    x="0"
                    y="0"
                    width="4"
                    height="4"
                    class="text-gray-200 dark:text-slate-500"
                    fill="currentColor"
                  />
                </pattern>
              </defs>
              <rect
                width="404"
                height="384"
                fill="url(#64e643ad-2176-4f86-b3d7-f2c5da3b6a6d)"
              />
            </svg>
            <svg
              class="absolute -bottom-16 -left-28"
              width="250"
              height="237"
              fill="none"
              viewBox="0 0 250 237"
              aria-hidden="true"
            >
              <defs>
                <pattern
                  id="c60d8d5a-cdbd-425a-9aab-1973b4c4f67e"
                  x="0"
                  y="0"
                  width="20"
                  height="20"
                  patternUnits="userSpaceOnUse"
                >
                  <rect
                    x="0"
                    y="0"
                    width="4"
                    height="4"
                    class="text-gray-200 dark:text-slate-500"
                    fill="currentColor"
                  />
                </pattern>
              </defs>
              <rect
                width="250"
                height="237"
                fill="url(#c60d8d5a-cdbd-425a-9aab-1973b4c4f67e)"
              />
            </svg>
            <h2 class="sr-only">Contact us</h2>

            <div class="grid grid-cols-1 md:grid-cols-3">
              <!-- Contact information -->
              <div
                class="relative rounded-t-lg bg-gradient-to-b from-indigo-600 to-indigo-700 py-4 py-4 px-4 dark:from-indigo-800 dark:to-indigo-900 sm:px-6 md:rounded-l-lg md:rounded-tr-none md:py-8 xl:p-8"
              >
                <!-- Decorative angle backgrounds -->
                <div
                  class="pointer-events-none absolute inset-0 sm:hidden"
                  aria-hidden="true"
                >
                  <svg
                    class="absolute inset-0 h-full w-full"
                    width="343"
                    height="388"
                    viewBox="0 0 343 388"
                    fill="none"
                    preserveAspectRatio="xMidYMid slice"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M-99 461.107L608.107-246l707.103 707.107-707.103 707.103L-99 461.107z"
                      fill="url(#linear1)"
                      fill-opacity=".1"
                    />
                    <defs>
                      <linearGradient
                        id="linear1"
                        x1="254.553"
                        y1="107.554"
                        x2="961.66"
                        y2="814.66"
                        gradientUnits="userSpaceOnUse"
                      >
                        <stop stop-color="#fff" offset="0" />
                        <stop offset="1" stop-color="#fff" stop-opacity="0" />
                      </linearGradient>
                    </defs>
                  </svg>
                </div>
                <div
                  class="pointer-events-none absolute top-0 right-0 bottom-0 hidden w-1/2 sm:block lg:hidden"
                  aria-hidden="true"
                >
                  <svg
                    class="absolute inset-0 h-full w-full"
                    width="359"
                    height="339"
                    viewBox="0 0 359 339"
                    fill="none"
                    preserveAspectRatio="xMidYMid slice"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M-161 382.107L546.107-325l707.103 707.107-707.103 707.103L-161 382.107z"
                      fill="url(#linear2)"
                      fill-opacity=".1"
                    />
                    <defs>
                      <linearGradient
                        id="linear2"
                        x1="192.553"
                        y1="28.553"
                        x2="899.66"
                        y2="735.66"
                        gradientUnits="userSpaceOnUse"
                      >
                        <stop stop-color="#fff" offset="0" />
                        <stop offset="1" stop-color="#fff" stop-opacity="0" />
                      </linearGradient>
                    </defs>
                  </svg>
                </div>
                <div
                  class="pointer-events-none absolute top-0 right-0 bottom-0 hidden w-1/2 lg:block"
                  aria-hidden="true"
                >
                  <svg
                    class="absolute inset-0 h-full w-full"
                    width="160"
                    height="678"
                    viewBox="0 0 160 678"
                    fill="none"
                    preserveAspectRatio="xMidYMid slice"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M-161 679.107L546.107-28l707.103 707.107-707.103 707.103L-161 679.107z"
                      fill="url(#linear3)"
                      fill-opacity=".1"
                    />
                    <defs>
                      <linearGradient
                        id="linear3"
                        x1="192.553"
                        y1="325.553"
                        x2="899.66"
                        y2="1032.66"
                        gradientUnits="userSpaceOnUse"
                      >
                        <stop stop-color="#fff" offset="0" />
                        <stop offset="1" stop-color="#fff" stop-opacity="0" />
                      </linearGradient>
                    </defs>
                  </svg>
                </div>
                <h3 class="mb-4 text-lg font-medium text-gray-50">
                  Informations de contact
                </h3>
                <p
                  class="max-w-3xl text-justify text-sm text-gray-100 dark:text-slate-100"
                >
                  {{
                    error
                      ? "Je m'engage à respecter votre vie privée, en aucun cas votre adresse ne sera communiquée à un tiers."
                      : contact.data.attributes.disclaimer
                  }}
                </p>
                <dl
                  class="mt-8 flex flex-col break-all sm:flex-row md:flex-col"
                >
                  <dt>
                    <span class="sr-only">Phone number</span>
                  </dt>
                  <dd class="flex text-gray-100 dark:text-slate-100">
                    <PhoneIcon
                      class="h-5 w-5 flex-shrink-0"
                      aria-hidden="true"
                    />
                    <div
                      v-if="!error"
                      ref="protectedPhone"
                      class="ml-2 cursor-pointer text-sm"
                      @copy="copyProtected"
                      @click="linkProtected($event, 'tel')"
                    >
                      {{ contact.data.attributes.protectedPhone }}
                    </div>
                    <span v-else class="ml-2 text-sm uppercase"
                      >+33 6 12 34 57 89</span
                    >
                  </dd>
                  <dt><span class="sr-only">Email</span></dt>
                  <dd
                    class="mt-2 flex text-gray-100 dark:text-slate-100 sm:ml-8 sm:mt-0 md:ml-0 md:mt-2"
                  >
                    <EnvelopeIcon
                      class="h-5 w-5 flex-shrink-0"
                      aria-hidden="true"
                    />

                    <div
                      v-if="!error"
                      ref="protectedEmail"
                      class="ml-2 cursor-pointer text-sm"
                      @copy="copyProtected"
                      @click="linkProtected($event, 'mailto')"
                    >
                      {{ contact.data.attributes.protectedEmail }}
                    </div>
                    <span v-else class="ml-2 text-sm uppercase"
                      >name@domain.tld</span
                    >
                  </dd>
                  <dt><span class="sr-only">Email</span></dt>
                </dl>
                <ul
                  role="list"
                  class="mt-8 flex justify-end space-x-4 md:mt-[100%] md:justify-between md:space-x-0"
                >
                  <li>
                    <a
                      class="text-indigo-200 hover:text-indigo-100 dark:text-indigo-300 dark:hover:text-indigo-200"
                      :href="`https://github.com/${
                        error ? '' : contact.data.attributes.github
                      }`"
                      target="_blank"
                    >
                      <span class="sr-only">GitHub</span>
                      <svg
                        class="h-7 w-7"
                        aria-hidden="true"
                        fill="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M12 0C5.4 0 0 5.5 0 12.3c0 5.4 3.4 10 8.2 11.7.6.1.8-.3.8-.6v-2.3c-3 .6-3.8-.8-4-1.4-.1-.4-.7-1.4-1.2-1.7-.4-.2-1-.8 0-.8.9 0 1.6.9 1.8 1.3 1.1 1.9 2.8 1.3 3.5 1 .1-.8.4-1.3.8-1.6-2.7-.3-5.5-1.4-5.5-6.1 0-1.3.5-2.4 1.2-3.3-.1-.5-.5-1.7.1-3.4 0 0 1-.3 3.3 1.3 1-.3 2-.4 3-.4s2 .1 3 .4c2.3-1.6 3.3-1.3 3.3-1.3.7 1.7.2 3 .1 3.3.8.9 1.2 2 1.2 3.3 0 4.7-2.8 5.8-5.5 6.1.4.4.8 1.1.8 2.3v3.4c0 .3.2.7.8.6 2.4-.8 4.5-2.4 5.9-4.5 1.5-2.1 2.3-4.6 2.3-7.2C24 5.5 18.6 0 12 0z"
                          clip-rule="evenodd"
                        />
                      </svg>
                    </a>
                  </li>
                  <li>
                    <a
                      class="text-indigo-200 hover:text-indigo-100 dark:text-indigo-300 dark:hover:text-indigo-200"
                      :href="`https://twitter.com/${
                        error ? '' : contact.data.attributes.twitter
                      }`"
                      target="_blank"
                    >
                      <span class="sr-only">Twitter</span>
                      <svg
                        class="h-7 w-7"
                        aria-hidden="true"
                        fill="currentColor"
                        viewBox="0 0 29.5 24"
                      >
                        <path
                          d="M26.5 6v.8c0 8-6.1 17.2-17.2 17.2-3.3 0-6.5-.9-9.3-2.7.5.1 1 .1 1.4.1 2.7 0 5.4-.9 7.5-2.6-2.6 0-4.9-1.7-5.7-4.2.9.2 1.8.1 2.7-.1C3.1 13.9 1 11.4 1 8.6v-.2c.8.5 1.8.7 2.8.8C1.1 7.4.3 3.9 1.9 1.1 5 4.9 9.5 7.2 14.4 7.4c-.5-2.1.2-4.3 1.8-5.8 2.4-2.3 6.3-2.2 8.6.3 1.4-.3 2.7-.8 3.8-1.5-.5 1.4-1.4 2.6-2.7 3.4 1.2-.1 2.4-.5 3.5-1-.6 1.3-1.7 2.3-2.9 3.2z"
                        />
                      </svg>
                    </a>
                  </li>
                  <li>
                    <a
                      class="text-indigo-200 hover:text-indigo-100 dark:text-indigo-300 dark:hover:text-indigo-200"
                      :href="`https://discordapp.com/users/${
                        error ? '' : contact.data.attributes.discord
                      }`"
                      target="_blank"
                    >
                      <span class="sr-only">Discord</span>
                      <svg
                        class="h-7 w-7"
                        aria-hidden="true"
                        fill="currentColor"
                        viewBox="0 0 22.2 24"
                      >
                        <path
                          d="M8.7 9.2c-.7 0-1.3.6-1.3 1.4S8 12 8.7 12c.7 0 1.3-.6 1.3-1.4 0-.7-.6-1.4-1.3-1.4zm4.7 0c-.7 0-1.3.6-1.3 1.4s.6 1.4 1.3 1.4c.7 0 1.3-.6 1.3-1.4s-.5-1.4-1.3-1.4z"
                        />
                        <path
                          d="M19.6 0h-17c-.3 0-.7.1-1 .2-.3.1-.6.3-.8.5-.3.3-.5.5-.6.8-.1.3-.2.6-.2 1v16.2c0 .3.1.6.2.9.1.3.3.6.6.8.2.3.5.5.8.6.3.1.7.2 1 .2H17l-.7-2.2 1.6 1.4 1.5 1.3 2.7 2.3V2.5c0-.3-.1-.6-.2-.9-.1-.3-.3-.6-.6-.8-.2-.2-.5-.4-.8-.5-.3-.2-.6-.3-.9-.3zm-4.9 15.7s-.5-.5-.8-1c1.7-.4 2.3-1.4 2.3-1.4-.5.3-.9.5-1.5.7-.6.2-1.2.4-1.8.5-1.1.2-2.2.2-3.3 0-.6-.1-1.3-.3-1.9-.5-.3-.1-.6-.3-.9-.4 0 0-.1 0-.1-.1h-.1l-.4-.2s.6 1 2.2 1.4l-.8 1c-2.8-.1-3.9-1.8-3.9-1.8 0-3.9 1.8-7 1.8-7 1.8-1.3 3.6-1.3 3.6-1.3l.1.1C7 6.4 5.9 7.3 5.9 7.3s.3-.1.8-.3c1.3-.6 2.4-.8 2.9-.8h.2c2.2-.3 4.4.1 6.4 1.1 0 0-1-.9-3.2-1.5l.2-.2s1.7 0 3.6 1.3c0 0 1.8 3.1 1.8 7-.1-.1-1.1 1.7-3.9 1.8z"
                        />
                      </svg>
                    </a>
                  </li>
                  <li>
                    <a
                      class="text-indigo-200 hover:text-indigo-100 dark:text-indigo-300 dark:hover:text-indigo-200"
                      :href="`https://www.root-me.org/${
                        error ? '' : contact.data.attributes.rootme
                      }`"
                      target="_blank"
                    >
                      <span class="sr-only">Root-Me</span>
                      <svg
                        class="h-7 w-7"
                        aria-hidden="true"
                        fill="currentColor"
                        viewBox="0 0 18.6 24"
                      >
                        <path
                          d="M9.5 19s-.1 0 0 0c-.1 0-.1 0 0 0h-.1l-.8.9c-.1.2-.1.3.1.4.1 0 .1.1.2.1s.2 0 .2-.1c.3-.4.9-.4 1.1 0 .1.1.2.1.2.1.1 0 .2 0 .2-.1.2-.1.2-.3.1-.4L9.5 19zM8.2 2.9c-.4 0-.7.3-.7.7L6 4.2l-.1.1v.9H4.7c-.1-.2-.4-.4-.7-.4-.4 0-.7.3-.7.7 0 .4.3.7.7.7.3 0 .6-.2.7-.5H6l.2-.2v-1L7.4 4c.2.2.4.4.6.4.4 0 .7-.3.7-.7.3-.4-.1-.8-.5-.8zM6.7 16.5l-.7-.2-.5-.3c.4.4 1.2 1 2.2 1 .1-.1.1-.2.2-.2-.2 0-.3-.1-.4-.1-.4 0-.6-.1-.8-.2zm11.9-6.7c0-.5 0-.9-.1-1.3v-.1C18 4.6 15.1 1.6 11.3.7c-.1-.3-.5-.7-.9-.7-.6 0-1 .4-1 .9s.3.9.8.9v3.5c0 .1 0 .1.1.2h.2l1.3-.5c.1.2.2.2.4.3v1.6c-.7.9-1.6 1.6-2.6 2.3l-1-2.5c.2-.2.3-.4.3-.6 0-.4-.3-.7-.7-.7-.4 0-.7.3-.7.7s.3.7.7.7l1.1 2.6c-.6.5-1.3.9-2 1.3l-3.2-.9H4l-.9.4c-.2-.2-.3-.4-.6-.4-.4 0-.7.3-.7.7s.3.7.7.7.7-.3.7-.7v-.1l.8-.3 2.8.9c-2.4 1.2-4.5 2-4.8 2.2l-.2.1c-.2-.1-.3-.2-.5-.2C.9 12 .6 10.9.6 9.8c0-.5.1-1.2.2-1.7H5c0 .3.3.5.7.5.4 0 .7-.3.7-.7 0-.4-.3-.7-.7-.7-.4 0-.7.2-.7.5H.9c.8-3.1 3.3-5.6 6.4-6.3.2.3.5.5.9.5.5 0 .9-.4.9-.9s-.4-1-1-1c-.4 0-.8.3-.9.8C3 1.7 0 5.5 0 9.8c0 1.2.2 2.5.7 3.6-.2.2-.3.4-.3.7 0 .4.3.8.6.9v3.7c0 .2 0 .3.1.3l.2.2 2.9 2v2.5c0 .2.2.4.4.4H14c.2 0 .4-.2.4-.4v-2.4l2.9-2 .2-.2c0-.1.1-.2.1-.2v-3.8c.4-.2.6-.5.6-.9 0-.2-.1-.5-.2-.6.3-1.1.6-2.5.6-3.8zM7.8.7c.1-.1.2-.2.3-.2.2 0 .5.2.5.5s-.2.5-.5.5c-.1 0-.2 0-.2-.1-.2-.1-.2-.2-.2-.4s0-.1.1-.3zm2.1.3c0-.2.2-.5.5-.5.2 0 .2.1.3.2s.2.2.2.3-.1.3-.2.4c-.1.1-.2.1-.2.1-.4 0-.6-.2-.6-.5zm1.8 3.7-1.2.5V1.9c.3-.1.5-.2.6-.5 1 .2 1.9.6 2.8 1.2 0 1.4-.5 2.7-1.4 3.9V5.3c.3-.1.5-.4.5-.7 0-.4-.3-.7-.7-.7-.3.1-.6.4-.6.8zM1.4 14.6c-.1 0-.2-.1-.3-.1-.1-.1-.2-.2-.2-.3V14c.1-.2.2-.3.4-.3.1 0 .2 0 .2.1.2.1.2.2.2.4 0 .1 0 .2-.1.2.1.2-.1.2-.2.2zm16.1-.1c-.1.1-.2.2-.4.2s-.2-.1-.3-.2c-.1-.1-.2-.2-.2-.3 0-.2.2-.4.3-.4h.2c.2 0 .4.2.5.4v.1s-.1.1-.1.2zm-.3-1.3c-.6 0-1 .4-1 .9 0 .4.2.8.6.9v3.5l-2.9 2.1c-.1.1-.2.2-.2.3v2c0 .1-.1.2-.2.2h-1.1c-.1 0-.2-.1-.2-.2v-.7c0-.2-.2-.4-.3-.4-.2 0-.4.2-.4.4v.8c0 .1-.1.2-.2.2H9.9c-.1 0-.2-.1-.2-.2v-1.1c0-.2-.2-.4-.3-.4-.2 0-.4.2-.4.4v1.2c0 .1-.1.2-.2.2H7.4c-.1 0-.2-.1-.2-.2v-.8c0-.2-.2-.4-.3-.4-.2 0-.4.2-.4.4v.8c0 .1-.1.2-.2.2H5.2c-.1 0-.2-.1-.2-.2v-2c0-.1-.1-.2-.2-.3l-2.9-2.1v-3.5c.3-.2.5-.5.5-.9v-.2c.4-.1 3.3-1.1 6.1-2.9 3.9-2.4 6-5.1 6.2-7.9 1.6 1.3 2.8 3.3 3.1 5.4-.1 4.7-8.3 7.7-8.4 7.7-.1 0-.2 0-.3-.1-.1 0-.2 0-.2-.1-.2 0-.2-.1-.4-.1h-.4c-.2 0-.2-.1-.4-.1-.2-.2-.5-.2-.7-.2-.2-.1-.5-.2-.6-.2-.2-.1-.3-.1-.5-.2-.1 0-.1 0-.2-.1-.1 0-.2-.1-.2-.1-.2 0-.2-.1-.3-.2-.2-.1-.3-.1-.5-.2-.1.2-.2.2-.4.1-.1-.1-.2-.1-.2-.1H4l.1.1c0 .1.1.1.2.2s.2.2.3.2c.2.1.2.2.4.3-.1.2-.1.4-.1.6 0 1.1.9 2 2 2 .9 0 1.5-.5 1.9-1.2h.8l1.6 1.6c.4.4 1 .5 1.5.2l2.5-1.4c.2-.2.4-.4.4-.6v-3c.9-.8 1.9-1.7 2.4-2.7-.3.7-.5 1.4-.8 2.1zm-9.4 3.7c0 .1-.1.2-.2.2-.2.2-.5.5-.9.5s-.7-.2-.9-.5c-.2-.2-.3-.5-.3-.8v-.2l.5.2.7.2.7.2c.2 0 .3 0 .4.2z"
                        />
                      </svg>
                    </a>
                  </li>
                </ul>
              </div>

              <!-- Contact form -->
              <div
                class="relative rounded-b-lg bg-white py-4 px-4 dark:bg-slate-900 sm:px-6 md:col-span-2 md:rounded-r-lg md:rounded-bl-none md:p-8 md:py-8 lg:px-8"
              >
                <h3
                  class="text-lg font-medium text-gray-900 dark:text-slate-200"
                >
                  Laisser moi un message
                </h3>
                <form
                  action="#"
                  method="POST"
                  class="mt-6 grid grid-cols-1 gap-y-6 sm:grid-cols-2 sm:gap-x-8"
                >
                  <div class="sm:col-span-2">
                    <label
                      for="email"
                      class="block text-sm font-medium text-gray-900 dark:text-slate-200"
                      >Email</label
                    >
                    <div class="mt-1">
                      <input
                        id="email"
                        name="email"
                        type="email"
                        autocomplete="email"
                        class="block w-full rounded-md border border-gray-100 py-3 px-4 text-gray-900 shadow-sm focus:border-indigo-600 focus:ring-indigo-600 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:focus:bg-slate-700 dark:focus:text-slate-100 dark:focus:outline-none dark:focus:ring-2"
                      />
                    </div>
                  </div>

                  <div class="sm:col-span-2">
                    <label
                      for="subject"
                      class="block text-sm font-medium text-gray-900 dark:text-slate-200"
                      >Subject</label
                    >
                    <div class="mt-1">
                      <input
                        id="subject"
                        type="text"
                        name="subject"
                        class="block w-full rounded-md border border-gray-100 py-3 px-4 text-gray-900 shadow-sm focus:border-indigo-600 focus:ring-indigo-600 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:focus:bg-slate-700 dark:focus:text-slate-100 dark:focus:outline-none dark:focus:ring-2"
                      />
                    </div>
                  </div>
                  <div class="sm:col-span-2">
                    <div class="flex justify-between">
                      <label
                        for="message"
                        class="block text-sm font-medium text-gray-900 dark:text-slate-200"
                        >Message</label
                      >
                      <span id="message-max" class="text-sm text-gray-500"
                        >Max. 500 characters</span
                      >
                    </div>
                    <div class="mt-1">
                      <textarea
                        id="message"
                        name="message"
                        rows="4"
                        class="block w-full rounded-md border border-gray-100 py-3 px-4 text-gray-900 shadow-sm focus:border-indigo-600 focus:ring-indigo-600 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:focus:bg-slate-700 dark:focus:text-slate-100 dark:focus:outline-none dark:focus:ring-2"
                        aria-describedby="message-max"
                      />
                    </div>
                  </div>
                  <div class="sm:col-span-2 sm:flex sm:justify-end">
                    <button
                      type="submit"
                      class="rounded-md border border-transparent bg-indigo-600 px-8 py-3 text-base font-medium text-gray-50 transition duration-150 ease-in-out hover:bg-indigo-700 dark:bg-indigo-800 dark:text-slate-100 dark:hover:bg-indigo-900 sm:w-auto"
                    >
                      Envoyer
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>
  </div>
</template>

<script setup>
import { EnvelopeIcon, PhoneIcon } from '@heroicons/vue/24/outline'

import { useFetch, useRuntimeConfig } from 'nuxt/app'
import { onMounted, ref } from 'vue'

const config = useRuntimeConfig()

const protectedPhone = ref(null)
const protectedEmail = ref(null)

const { data: contact, error } = await useFetch(
  `${config.public.strapiUrl}/api/contact?populate=*`
)

onMounted(() => {
  const elements = [protectedPhone.value, protectedEmail.value]
  const pushedValue = []
  const css = []
  css.push('<style>')
  css.push(
    '.changedirection { unicode-bidi: bidi-override; direction: rtl; text-align: left; }'
  )
  css.push('.protected { white-space: nowrap; }')
  css.push('.protected .letter span[class] span { color: transparent; }')
  css.push('.protected span[class]:after { position: absolute; right: 0; }')
  css.push('.letter { position:relative; display:inline-flex;  }')
  css.push(
    '.letter { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }'
  )
  elements.forEach((el) => {
    const html = []
    const string = deobfuscateString(el.innerText)
    const strArray = string.split('').reverse().join('')
    for (let i = 0; i < strArray.length; i++) {
      let strRot47 = rot47(strArray[i])
      if (strRot47 === ' ') {
        strRot47 = '&nbsp;'
      }
      const cssClass = 'c-' + strArray[i].charCodeAt(0)
      if (!pushedValue.includes(cssClass)) {
        css.push(`.${cssClass}:after { content: "${strArray[i]}"; }`)
        pushedValue.push(cssClass)
      }
      html.push(
        `<span class="letter"><span class="${cssClass}"><span>${strRot47}</span></span></span>`
      )
    }
    el.innerHTML = html.join('')
    el.classList.add('uppercase', 'protected', 'changedirection')
  })

  if (process.client) {
    document.head.insertAdjacentHTML('beforeend', css.join('\n'))
  }
})

const linkProtected = (e, protocol) => {
  window.open(
    protocol +
      ':' +
      deobfuscateString(
        obfuscateString(contact.value.data.attributes.email)
      ).replace(' ', ''),
    '_blank'
  )
  e.preventDefault()
}

const copyProtected = (e) => {
  const selection = document.getSelection()
  const range = new Range()
  let nodeParent = e.srcElement
  while (nodeParent.localName !== 'div') {
    nodeParent = nodeParent.parentNode
  }
  range.selectNodeContents(nodeParent)
  selection.removeAllRanges()
  selection.addRange(range)

  e.clipboardData.setData(
    'text/plain',
    rot47(selection.focusNode.textContent.split('').reverse().join(''))
  )
  e.preventDefault()
}

function encodeBase64(string) {
  if (process.client) {
    return window.btoa(unescape(encodeURIComponent(string)))
  } else {
    return Buffer.from(string, 'ascii').toString('base64')
  }
}

function decodeBase64(string) {
  if (process.client) {
    return decodeURIComponent(escape(window.atob(string)))
  } else {
    return Buffer.from(string, 'base64').toString('ascii')
  }
}

function rot47(data) {
  const result = []
  for (let i = 0; i < data.length; i++) {
    const charCode = data.charCodeAt(i)
    if (charCode >= 33 && charCode <= 126) {
      result[i] = String.fromCharCode(33 + ((charCode + 14) % 94))
    } else {
      result[i] = String.fromCharCode(charCode)
    }
  }
  return result.join('')
}

function obfuscateString(string) {
  let result = string.split('').reverse().join('')
  result = encodeBase64(result)
  result = rot47(result)
  result = encodeBase64(result)
  return result
}

function deobfuscateString(string) {
  let result = decodeBase64(string)
  result = rot47(result)
  result = decodeBase64(result)
  result = result.split('').reverse().join('')
  return result
}

// TODO: https://vuejsexamples.com/build-simple-recaptcha-for-vuejs-without-server-need/
// CloakingEmail https://github.com/martignoni/hugo-cloak-email
// Test scrapping mail with Antheta https://antheta.com/
</script>
